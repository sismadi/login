<script>
  // ==== KONFIGURASI ====
  const CLIENT_ID = "Ov23lis3fqdO2Kv7zyvI";
  const REDIRECT_URI = "https://sismadi.github.io/login/"; // contoh: "https://sismadi.github.io/login/"
  const SCOPES = ["read:user", "user:email"];

  // Gunakan proxy worker Anda di sini:
  const TOKEN_PROXY = "https://myapp.wawan.workers.dev/token";

  // ==== UTIL ====
  const b64url = (buf) => {
    return btoa(String.fromCharCode(...new Uint8Array(buf)))
      .replace(/\+/g, "-").replace(/\//g, "_").replace(/=+$/,"");
  };
  const sha256 = async (str) => {
    const data = new TextEncoder().encode(str);
    return await crypto.subtle.digest("SHA-256", data);
  };
  const randStr = (len=64) => {
    const arr = new Uint8Array(len);
    crypto.getRandomValues(arr);
    return Array.from(arr).map(b=>("0"+b.toString(16)).slice(-2)).join("");
  };

  // ... (fungsi UI & helper tetap sama)

  async function exchangeCodeForToken(code, stateFromUrl) {
    const state = sessionStorage.getItem("gh_state");
    const verifier = sessionStorage.getItem("gh_verifier");
    if (!state || !verifier || state !== stateFromUrl) {
      throw new Error("State/verifier tidak cocok. Ulangi login.");
    }

    const payload = {
      client_id: CLIENT_ID,
      grant_type: "authorization_code",
      code,
      redirect_uri: REDIRECT_URI,
      code_verifier: verifier
    };

    // ðŸš€ Langsung pakai proxy
    const res = await fetch(TOKEN_PROXY, {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify(payload)
    });
    if (!res.ok) throw new Error("Proxy error: "+res.status);

    return await res.json();
  }

  // ... (fungsi lain tidak berubah, hanya exchangeCodeForToken yang dipaksa via proxy)
</script>
